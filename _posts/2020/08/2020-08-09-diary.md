---
title: 105 日目（晴れ）Jekyll のアップグレードでハマる
---

テレビの隅田川の静止画を観ながら眠る。この川を横切る鉄道がけっこう多いとのことだ。

8:35 起床。わりと涼しい。この部屋が西向きだからか。朝飯は納豆と讃岐うどん。
冷蔵庫に保管しておいたらヒエヒエになり過ぎて麺が固まっている。夏だからそのうちなんとかなる。

サンデーモーニングは黒板が出るわ紙芝居が手描きだわでなかなかのアナログ志向だ。

ナイトメアブレイド直前のセーブデータ作成。
ナイトメアブレイドの正攻法がいまだにわからない。

11:00 過ぎ外出。バス発着時刻ギリギリにバス停に来るように時間調整しないと直射日光にやられる。
とにかく四ツ木橋南詰に移動。さらに徒歩で八広図書館に移動。朝刊を読んでウンコしてから入館。
キャレルがけっこう埋まっている。なんとか着席。

メールがあるのでチェックすると GitHub からだ。当ブログの一部プラグインにセキュリティーホールが発見されたのでアップグレードしろとある。
というか、このブログ宛に専用ボットがパッチコードをリクエストしている。すごい時代になったものだ。
それの対応に時間をとられる。前ブログも同様。ただしそちらは Jekyll のアップグレードからやるハメになる。
するとリンクの貼り方が少し変わるので、テキスト置換処理が発生する。
これをローカルでビルドしてテストすると、数式が表示されていないことがいまさら発覚する。
これは直し切れない。明日以降。

14:25 ビッグエー墨田八広店。205 円。

* ハムマヨパン
* すっぱムーチョ梅
* コッペパンジャム＆マーガリン

隣の公園の木陰で立ち食い。公園の前にバス停があるので時計とにらめっこしながら食い切る。

都バスで横川コミュニティー会館図書室近くに移動。柳島児童遊園で水浴びしたいが、水遊びしている親子がいるので諦める。
図書館に入って教科書を進める。気が済んだら退館。

オリナスに移動。館内が涼しくていい。地下のタイトー F ステーションオリナス錦糸町店に入店。
今日は負けそうな気がするので、いきなり MJ 筐体に着席。案の定最初はトップが獲れない。

```text
【SCORE】
合計SCORE:-94.5

【最終段位】
四人打ち段位:雷神 幻球:8

【8/9の最新8試合の履歴】
1st|----***-
2nd|-*------
3rd|--*-----
4th|*--*---*
old         new

【順位】
1位回数:4(17.39%)
2位回数:8(34.78%)
3位回数:4(17.39%)
4位回数:7(30.43%)
平均順位:2.61

プレイ局数:112局

【打ち筋】
アガリ率:21.43%(24/112)
平均アガリ翻:3.04翻
平均アガリ巡目:9.79巡
振込み率:16.07%(18/112)

【8/9の最高役】
・役満
・跳満
```

後半あまりの配牌の悪さに国士をテンパイ、トップ目からアガってしまう。それでも 300 点残っているのがすごい。上級者は怖い。
それを含む 3 ゲーム連続でトップを獲得。なんだこれは。4 ゲーム目にダブロンを食らって確変終了。
そのまま外へ出る。

いつの間にか 21:00 を過ぎている。歩いて業平方面に移動。

21:35 ビッグエー墨田業平店。468 円。

* ハンバーグ弁当
* シュークリーム
* ふっくらおむすび各種 (2)

いつもの経路で向島の部屋に戻る。毎日なぜかスカイツリーを超える辺りから暑くなる。
シャワーを浴びて出てテレビを観ながら晩飯。風呂上がりのほうが暑い。
半沢直樹のドラマ、東京新聞で金融庁の役人がダメ出しをしていたが、その指摘は当たっているようだ。

22:40 PC 開始。今晩は数学ノートをやっている時間がないか。明日の朝やるか。
ナイトメアブレイドを研究しよう。

* 死の宣告はたぶん MAX HP と同じ値をターン終了後に引くような処理になっている。ドラクエのザキとは違う。
  攻略本にあるように、ターン終了後に HP を回復するものを装備すると助かる。これだけでグッと楽になる。
* 直接攻撃をメインにする？
* 撃破するとパーティーメンバーの攻撃力、防御力、魔力、魔法防御、敏捷性がそれぞれ 5 ポイント増加する。

![ナイトメアブレイド]({{ "/assets/images/nightmareblade.png" | relative_url }})

## Math Notes

**区間推定**：

1. $1$ に近い確率 $\gamma$ を選ぶ。
2. 未知母数を $\theta$ とする。$\Theta_1 \lt \theta \lt \Theta_2$ となる確率が
   $\gamma$ であるように $\Theta_1, \Theta_2$ を標本値から決める。

この $\gamma$ を**信頼率** a.k.a. **信頼水準**という。
またこの $\Theta_1, \Theta_2$ を**信頼限界**、区間 ${[\Theta_1, \Theta_2]}$ を**信頼区間**という。

----

母平均の区間推定その一：母分散が既知であるときに母平均を推定する。

$\bar X$ が $N(\mu, \sigma^2/n)$ に従うことから $Z \coloneqq \dfrac{\bar X - \mu}{\sigma/\sqrt{n} }$
は $N(0, 1)$ に従う。確率 $\gamma$ に対してある $z_1 \gt 0$ があって：

$$
\def\de{ \frac{\sigma}{\sqrt{n} }z_1 }
\bar X - \de \lt \mu \lt \bar X + \de.
$$

----

母平均の区間推定その二：母分散が未知であるときに母平均を推定する。

確率変数 $\dfrac{(n - 1)(\bar X - \mu)^2}{S^2}$ が自由度
$(1, n - 1)$ の $F$ 分布に従うことから $\mu$ の信頼区間が決まる。

ある確率 $\gamma$ に対して $x_1 \gt 0$ があって

$$
\def\de{ \frac{S\sqrt{x_1} }{ \sqrt{n - 1} } }
\begin{aligned}
&x_1 \gt \dfrac{(n - 1)(\bar X - \mu)^2}{S^2}.\\
\therefore & \bar X - \de \lt \mu \lt \bar X + \de.
\end{aligned}
$$

または $\dfrac{\sqrt{n - 1} }{S}(\bar X - \mu)$ が自由度 $n - 1$ の $t$ 分布に従うことから

$$
\def\de{ \frac{St_1}{\sqrt{n - 1} } }
\begin{aligned}
&-t_1 \lt \frac{\sqrt{n - 1}}{S}(\bar X - \mu) \lt t_1.\\
\therefore & \bar X - \de \lt \mu \lt \bar X + \de.
\end{aligned}
$$

----

母分散の区間推定：正規母集団からサイズ $n$ の標本を無作為抽出し、
その $S^2$ から母分散 $\sigma^2$ を信頼水準 $\gamma$ で区間推定する。

$\dfrac{nS^2}{\sigma^2}$ が自由度 $n - 1$ の $\chi^2$ 分布を用いる。
分布曲線の両裾の面積の和が $1 - \gamma$ となるような $x_1 \gt 0, x_2 \gt 0$ が存在する。

$$
\begin{aligned}
&x_1 \lt \frac{nS^2}{\sigma^2} \lt x_2.\\
\therefore & \frac{nS^2}{x_2} \lt \sigma^2 \lt \frac{nS^2}{x_1}.
\end{aligned}
$$

コメント：これは計算間違いをしやすい気がする。評価は $n$ だが自由度は $n - 1$ なのはこの推定だけ。

----

例題：この前の卵の例題を使う。標本値から信頼率 $95\%$ で母平均の信頼区間を推定する。
ただし母分散は実は $\sigma^2 = 4.0$ であるとする。

解：まず正規分布 $N(0, 1)$ で中央 $95\%$ を与える $z_1$ を求める。
SciPy だと `scipy.stats.norm` の `interval(0.95)` で得られる。

あとは $n = 10, \bar X = 69.05, \sigma = 2.0$ を代入して以下の信頼区間を推定する：

```python
>>> from math import sqrt
>>> from scipy.stats import norm
>>> norm.interval(0.95)
(-1.959963984540054, 1.959963984540054)
>>> z_1 = _[1]
>>> 2.0/sqrt(10)*z_1
1.2395900646091231
>>> 69.05 - _, 69.05 + _
(67.81040993539088, 70.28959006460911)
```

----

信頼水準を低く決めると信頼区間が狭くなる。これは不確実さが増すということを意味する。
区間推定では信頼区間のとり方が決定的であることがわかる。

----

例題：では母分散がやはり未知である場合には、母平均の推定はどうなるか。

解：$F$ 分布による推定をする。信頼率が $95\%$ とすることから、教科書の数表を参照するには
$\alpha = 0.05$ を見る。SciPy では `f.isf(0.05, ...)` が対応するが直接 `f.ppf(0.95, ...)` でよい。

```python
>>> n = 10
>>> Xbar = 69.05
>>> S2 = 4.1845
>>> from scipy.stats import f
>>> f(1, n - 1).ppf(0.95)
5.117355029199227
>>> x_1 = f(1, n - 1).ppf(0.95); x_1
5.117355029199227
>>> delta = sqrt(S2) * sqrt(x_1) / sqrt(n - 1); delta
1.5424933682437725
>>> Xbar - delta, Xbar + delta
(67.50750663175623, 70.59249336824377)
```

母平均の信頼区間は $67.5 \lt \mu \lt 70.6.$

$t$ 分布を用いるならば `t.interval()` がよい。同じ信頼区間が得られる：

```python
>>> from scipy.stats import t
>>> t(n - 1).interval(0.95)
(-2.2621571627409915, 2.2621571627409915)
>>> t_1 = _[1]
>>> delta = sqrt(S2) * t_1 /sqrt(n - 1); delta
1.5424933682047601
>>> Xbar - delta, Xbar + delta
(67.50750663179524, 70.59249336820476)
```

----

例題：卵の母分散の信頼区間を信頼水準 $95\%$ で推定しろ。

解：数表を利用するのであれば二度参照することになる。
まず $(1 - \gamma)/2$ を求めてから数表から直接パラメーター $x_2$ を参照し、
次に $1 - (1 - \gamma)/2$ を求めてから対応するパラメーター $x_1$ を参照する。

SciPy を使うと `chi2(n - 1).interval(gamma)` で得られる。

```python
>>> from scipy.stats import chi2
>>> chi2(n - 1).interval(0.95)
(2.7003894999803584, 19.02276779864163)
>>> x_1, x_2 = chi2(n - 1).interval(0.95)
>>> n * S2 / x_2, n * S2 / x_1
(2.199732470213301, 15.495912719370432)
```

母分散の信頼区間は $2.2 \lt \sigma^2 \lt 15.5.$

----

問：夏みかん $16$ 個を標本とみなして標本平均、標本分散を計算すると
$\bar X = 152,S^2 = 34.2^2$ であった。母集団がある正規分布に従うとする。
このとき信頼水準 $99\%$ で次の区間推定をしろ：

1. 母分散が $\sigma^2 = 28.6^2$ であると判明しているとき
2. 母分散が未知であるとき

解：まず正規分布 $N(0, 1)$ で中央 $99\%$ を与える $z_1$ を求める。
あとは $n = 16, \bar X, \sigma = 2.0$ を代入して以下の信頼区間を推定する：

```python
>>> from math import sqrt
>>> from scipy.stats import norm
>>> n, Xbar, sigma = 16, 152, 28.6
>>> z_1 = norm.interval(0.99)[1]; z_1
2.5758293035489004
>>> delta = sigma/sqrt(n)*z_1; delta
18.41717952037464
>>> Xbar - delta, Xbar + delta
(133.58282047962535, 170.41717952037465)
```

$133.6 \lt \mu \lt 170.4.\quad\square$

母分散が使えないときは $F$ 分布による。$f_{1, n - 1}(x)$ の左側
$99\%$ の値 $x_1$ を求めてから「公式」に代入する。

```python
>>> n, Xbar, S = 16, 152, 34.2
>>> from scipy.stats import f
>>> x_1 = f(1, n - 1).ppf(0.99); x_1
8.683116817638966
>>> delta = S * sqrt(x_1) / sqrt(n - 1); delta
26.02065942616013
>>> Xbar - delta, Xbar + delta
(125.97934057383986, 178.02065942616014)
```

$126.0 \lt \mu \lt 178.0.\quad\blacksquare$

----

問：カセットテープ $10$ 巻の録音時間を調べたら次のようになった：

```text
1447, 1443, 1442, 1438, 1448, 1449, 1423, 1439, 1472, 1428
```

これらカセットテープがある正規母集団から無作為抽出された標本であるとみなし、
信頼水準 $95\%$ で母平均と母分散をそれぞれ区間推定しろ。

解：まず $\bar x, s^2$ を計算して得る。母平均は $F$ 分布または $t$ 分布を用いて推定し、
母分散は $\chi^2$ 分布を用いて推定する。

```python
>>> import numpy as np
>>> data = np.array([1447, 1443, 1442, 1438, 1448, 1449, 1423, 1439, 1472, 1428])
>>> n = data.size
>>> xbar = data.mean(); xbar
1442.9
>>> S2 = data.var(); S2
158.49
>>> gamma = 0.95
>>> x_1 = f(1, n - 1).ppf(gamma); x_1
5.117355029199227
>>> D = sqrt(S2) * sqrt(x_1) / sqrt(n - 1)
>>> xbar - D, xbar + D
(1433.4070224869013, 1452.392977513099)
```

母平均の信頼区間は $1433.4 \lt \mu \lt 1452.4$ と推定された。

```python
>>> x_1, x_2 = chi2(n - 1).interval(gamma)
>>> x_1, x_2
(2.7003894999803584, 19.02276779864163)
>>> n * S2 / x_2, n * S2 / x_1
(83.31595153640964, 586.9153320332226)
```

母分散の信頼区間は $83.3 \lt \mu \lt 587.0$ と推定された。
$\blacksquare$

----

以上
