---
title: 228 日目（曇り一時雨）新パターン発見か
---

6:55 起床。携帯電話の目覚まし時計の止め方がよくわかっていないので、先に起きる。
朝食を食っても 7:15 という早い時刻なのだが、とっとと外出して勤務先である隣町に行く。

やはり早く着いてしまった。ちょっとした商店街を歩き回って時間を潰すと、いいことに気づく。
ここはビッグエーが存在する上に、明治通りにきわめて近い。
ということは、PC かばんを持って出勤すれば退勤直後にバス停に行けるということだ。
これはかなりの時間的節約が期待できる。明日試験的にやってみるか。

8:00 某集合住宅で作業開始。ゴミ出しがない日なのでひたすら清掃。
外の壁のカビを剥がしていると雨が降ってくる。なんと間の悪い。

10:00 を過ぎたとことろで時間オーバーに気づく。携帯電話で作業報告をして管理室を閉める。
まっすぐ曳舟の部屋に戻る。警察官が特殊詐欺注意のチラシを配っている。

明治通りのバス停からバスに乗って荒川区役所前に移動。11:25 ゆいの森あらかわ到着。四階。
今日は Stroustrup 本読みに専念する。他にはファイルの更新くらいしかしていない。
13:30 退館。

バスに乗って 14:35 曳舟の部屋に戻る。PC をホームポジションに戻しておやつ休憩。
勝手に製作した [soejima1000][soejima1000] アルバムを聴きながら居眠り。16:10 外出。

スカイツリータウン三省堂書店で雑誌チェックを試みるが、客が多くて途中でやめる。
とっととバスに乗る。太平四丁目に移動。

タイトー F ステーションオリナス錦糸町店。7 クレ遊ぶ。
MJ プロ卓東風戦。せっかく調子を上げて二連勝するものの、親ッパネに放銃して途中で退散。
このひどい放銃もそうだが、三軒リーチが多発する変な日だった。

```text
【SCORE】
合計SCORE:-82.3

【最終段位】
四人打ち段位:鬼神 幻球:4

【12/10の最新8試合の履歴】
1st|-----**-
2nd|----*---
3rd|*-**----
4th|-*-----E
old         new

【順位】
1位回数:2(20.00%)
2位回数:2(20.00%)
3位回数:3(30.00%)
4位回数:3(30.00%)
平均順位:2.70

プレイ局数:41局

【打ち筋】
アガリ率:14.63%(6/41)
平均アガリ翻:3.67翻
平均アガリ巡目:12.67巡
振込み率:14.63%(6/41)

【12/10の最高役】
・跳満
```

19:35 カスミオリナス錦糸町店。214 円。割引クーポンゲット。

* 生姜焼き丼

19:55 ビッグエー墨田業平店。408 円。

* ベビーチーズ鉄分 (4)
* 大きなおむすびツナマヨ
* おにぎり鮭の柚子胡椒風
* コッペパンジャム＆マーガリン
* ポテチ塩

20:15 曳舟の部屋に戻る。PC を開いて晩飯。最近、時間の調整の都合で夜やることがなくて Twitter の時間が長くなる。

21:50 入浴の時間とする。22:30 脱出。そういえば明日は洗濯日だ。パートタイムがあるので難しい。

久しぶりに[地獄の伯爵令嬢の逆襲][bshf20]をプレイする。デバッグモードオフで最初から。
一時間でレベル 26 かそこらまでいけるようだ。石碑弱制覇＆ガーゴイル像制覇＆アステカチャレンジ 4 まで。水晶玉未着手。

23:40 就寝準備。

## 『C++ のエッセンス』読書ノート

Bjarne Stroustrup 著、柴田望洋訳『C++ のエッセンス』（2015 年、SB クリエイティブ株式会社）

* 第 8 章 入出力ストリーム
* 第 7 章 文字列と正規表現

### 8.1 はじめに

* 入出力ストリームは、テキストや数値を書式あり・なしでバッファリングする入出力機能と考えられる。
* `ostream` はオブジェクトを文字・バイトのストリームに変換する。
  反対に `istream` は文字・バイトのストリームをオブジェクトに変換する。
* これらの処理は型安全・型付けがされているだけでなく、ユーザー定義型を処理するように拡張することも可能だ。
* それ以外の形態の入出力は標準の範囲外だ。
* 本書では扱われないが、標準ストリームはロケール依存であり、高度なバッファリング手法を採用している。

### 8.2 出力

目新しいことはないようなので省略。

### 8.3 入力

ここも C++03 と変わりはない。

* 〈デフォルトでは、スペースなどの空白類文字は読み取りを終了させる。（略）
  末尾の改行文字までの行全体を読み取る場合は `getline()` 関数を使う〉

### 8.4 入出力の状態

* `iostream` は状態を持っている。ストリームオブジェクト自身が `bool` に変換される。
* `cin >> i` を `if` 文の条件部に書くこともできる。
* `cin.eof()`, `cin.fail()` など、直接状態を問い合わせるメンバーもある。
* `cin.clear()` で状態を勝手にリセットできる。
* `cin.setstate(ios_base::failbit)` などとすることで状態を勝手にセットできる。

### 8.5 ユーザ定義型の入出力

ここも C++03 と変わりはない。

* 出力演算子のオーバーロードは単純に書ける。一方、〈入力演算子のそれは書式の確認や
  エラー処理が必要なので、少し複雑になる〉。
* サンプルコードでは最終的にストリームオブジェクトのフラグを失敗にマークする場合がある。
  例外を送出することはできないのだろうか。
* 入力演算子は `istream` への参照を返すので、それをうまく使って入力のオーバーロードを実装する。
* `is.get(c)` は空白文字を読み飛ばさない。

### 8.6 書式化

* もっとも単純な書式化の制御は、操作子によって行える。定義されているヘッダーファイルが複数にばらけている：
  * `<ios>`
  * `<istream>`
  * `<ostream>`
  * `<iomanip>`: 引数を受け取る操作子が定義されている。

* 浮動小数点数値の出力書式を学ぶ。
  * 一般書式 `defaultfloat`: 処理系に適当な書式を選択させる。これが C++11 機能。
  * 科学技術書式 `scientific`
  * 固定書式 `fixed`

* 浮動小数点数値は丸められる。
* `precision()` は整数に影響しない。
* 浮動小数点数の書式は有効性が持続する。一度出力してリセット、ではない。

### 8.7 ファイルストリーム

`<fstream>` の提供する機能の話題だが、ここで述べられていることは `iostream` の機能に過ぎない。

### 8.8 文字列ストリーム

`<sstream>` の提供する機能の話題だが、ここで述べられていることは `iostream` の機能に過ぎない。

### 8.9 アドバイス

> (11) `>>` はデフォルトでは空白文字を読み飛ばす  
> (12) 回復できる可能性がある入出力エラーを処理するには、ストリーム状態 `fail` を調べよう。  
> (20) ファイルストリームのコピーを試みないようにしよう。
> (22) メモリ上で書式化するのであれば、`stringstream` を利用しよう。  

----

### 7.1 はじめに

* C++ の正規表現は近代的な言語のほとんどと似た形式のものだ。
* `string` オブジェクトと `regex` オブジェクトは、Unicode を含むさまざまな文字型をサポートしている。

### 7.2 文字列

* 〈標準の `string` はムーブコンストラクタを実装しているので、長い `string` を値で返す処理は、
  効率よく行われる〉

#### 7.2.1 `string` の実装

〈近年、`string` は、短い文字列の最適化という手法で実装されている。
これは、短い文字列の値を `string` オブジェクト自身の中に保持しておき、
長いものを空き領域に置くというものだ〉

### 7.3 正規表現

* 〈標準ライブラリは `<regex>` で、`std::regex` クラスと、それを補助する関数とで正規表現のサポートを提供する〉
* パターンの表現には Python のように原文字列リテラルを利用するといい。
  C++ では次のように文字列リテラルを定義することもできる：

  ```c++
  R"(pattern)"
  ```

* `<regex>` が提供する主な機能：
  * `regex_match()`
  * `regex_search()`
  * `regex_replace()`
  * `regex_iterator`
  * `regex_token_iterator`

#### 7.3.1 探索

* 関数 `regex_search()` は `bool` 値を返す。引数の `smatch` オブジェクトに結果を格納する。
  このオブジェクトは〈一致部分の `string` 型を要素とする `vector` である〉。

#### 7.3.2 正規表現の表記

正規表現には「方言」がいろいろある。C++ の正規表現ライブラリでは ECMAScript で利用されている
ECMA 標準の変種をデフォルトの「方言」として採用している。

このサブセクションは正規表現のメタキャラクターに関する説明に終始しているので省略。

#### 7.3.3 反復子

* `sregex_iterator` のコンストラクター呼び出しで正規表現の検索をする。
  * `sregex_iterator` は `regex_iterator<string>` のことだ。
* `regex_iteartor` は双方向反復子なので、入力ストリームに対する反復処理を直接的に行うことはできない。
* `sregex_iterator` のデフォルトコンストラクターが返す反復子が `end()` 相当。

### 7.4 アドバイス

> (2) C 言語スタイルの文字列関数よりも、`string` 処理を優先しよう。  
> (4) `string` を帰す場合は、（ムーブセマンティクスに基づいて）値で返却しよう。  
> (10) どうしても必要ならば（どうしても必要な場合に限り）、`string` の C 言語スタイル文字列表現の生成に `c_str()` を利用しよう。  
> (14) きわめて単純なパターンでなければ、正規表現の記述には原文字列を優先しよう。  
> (17) 正規表現の文法は、さまざまな標準に準拠するように細かく制御できる。  
> (22) ストリームに対してパターンを反復して探すには `regex_iterator` を使おう。  

----

[bshf20]: https://wodifes.net/game/show/412
[soejima1000]: https://www.youtube.com/user/soejima1000/videos
