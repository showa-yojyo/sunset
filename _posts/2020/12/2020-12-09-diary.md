---
title: 227 日目（曇りのち晴れ）一日二時間労働なのに疲れがたまる
---

6:55 起床。朝食をとって外出しようとするとまだ時刻が 7:15 で早い。
事実、まっすぐ隣町の現場管理室に着くとまだ 7:35 かそんなものだ。
携帯電話で時間を潰すが、そんなことをしているとデータ通信量が今月から跳ね上がりそうで怖い。

今日のゴミは資源ごみ。隣町なのに全然違う。異状なし。
残り時間で住居部廊下の清掃。壁のカビがひどい。途中で管理人らしき人物に遭遇。
勤務三日目での対面か。挨拶が遅れてしまった。

10:00 作業終わり。自分の携帯電話で報告してまっすぐ曳舟の部屋に戻る。
仕事道具を置いて代わりに PC かばんを肩にかけて外出。またバスが行ってしまう。

尿意を覚えるが構わずやってきたバスに乗る。しかし三ノ輪交差点で危険を感じる。
大関横丁で降りて、近くのオリンピックでトイレを使わせてもらう。ドカジャンを売っているようなら買いたい。しかし見つからず。

そのまま徒歩でゆいの森あらかわに移動。11:35 入館。四階へ。

* Stroustrup 本を少しずつ読み進める。`rbegin()` から `rend()` へ向かって。
* Twitter のブックマーク機能を信用するなという教訓を得た。次からはスクリーンショットを実行する。
* [ラジルギスワッグ オリジナルサウンドトラック ヴァイナルエディション teaser movie - YouTube](https://www.youtube.com/watch?v=JFnSRvjK03s)

14:00 朝刊（東京）を読んで退館。そういえばバスで読み進めていた [Wizardry 8 のプレイ記録][metal]をさっき読み終えてしまったのだった。
終盤の盛り上げかたがたいへん良かった。この日記の著者は本物のプレイヤーだ。

14:50 曳舟の部屋に戻る。PC とおやつ休憩だ。昨日買い過ぎた食料を空腹に流し込む。

LibreOffice Calc のドキュメントを WSL から開けることにようやく気づく。`wslview` と `wslpath` を組み合わせるのだ。

15:50 眠くなる。食い過ぎか？ [soejima1000][soejima1000] 先生のマリオメドレー。
ダウンロードしてきた作品は必ず最後に作中に使われていないはずのマリオワールドのステージクリアのジングルで〆るのが笑える。

16:20 外出。押上駅バスターミナルに移動。バスに乗って太平四丁目で降りる。

17:00 ローソンストア 100 墨田太平店。220 円。

* 靴下 (2)

タイトー　F ステーションオリナス錦糸町店で 5 クレ遊ぶ。
ビートマニア STEP UP モード。トルコステージに進む。
MJ プロ卓東風戦。いい感じだ。

```text
【SCORE】
合計SCORE:+141.0

【最終段位】
四人打ち段位:雷神 幻球:13

【12/9の最新8試合の履歴】
1st|-*---*--
2nd|*-*-*--*
3rd|------*-
4th|---*----
old         new

【順位】
1位回数:3(33.33%)
2位回数:4(44.44%)
3位回数:1(11.11%)
4位回数:1(11.11%)
平均順位:2.00

プレイ局数:43局

【打ち筋】
アガリ率:20.93%(9/43)
平均アガリ翻:3.56翻
平均アガリ巡目:12.67巡
振込み率:0.00%(0/43)

【12/9の最高役】
・倍満
```

倍満をアガった局。リーチをかけた瞬間に、この局は一発でアガるかそうでないかのどちらかしかないと直感した。
捨牌三段目、上家が仕掛けを入れている、私の河に筒子がダンゴ状態、それでいて二五筒待ちだもの。いい条件が揃いすぎている。
そしてそれは上家の一発ロンという形で成就した。

19:35 カスミオリナス錦糸町店。343 円。

* チャーハン・海老入り焼きそば

19:55 ビッグエー墨田業平店。415 円。

* シュークリーム
* 大きなおむすびツナマヨ
* おにぎりねぎとろ
* あんパン
* ポテチ塩

20:10 曳舟の部屋に戻る。PC を開けて帳簿をつけて晩飯。

テザリングで Twitter をダラダラ見る。データ通信量を気にするとこれくらいしか見るものがない。
ダラダラし過ぎて携帯電話の充電が 100 パーになってしまった。

22:05 入浴。22:45 風呂から出て PC に復帰。
そういえばスクリーンセーバーの内容がいつの間にか Windows 10 に変わっていたので時刻に設定する。

Git の `pre-commit` を調べていると複雑なサンプルしか見つからないのでやめる。

23:40 消灯準備。

## 『C++ のエッセンス』読書ノート

Bjarne Stroustrup 著、柴田望洋訳『C++ のエッセンス』（2015 年、SB クリエイティブ株式会社）

* 第 10 章 アルゴリズム
* 第 9 章 コンテナ

### 10.1 はじめに

* 標準アルゴリズムは半開区間の要素のシーケンスを処理する。それは先頭要素を指す反復子と、
  末尾要素の直後を指す反復子とで表現される。
* 標準ライブラリの `list` はムーブコンストラクタをもっているので、このコードのような
  `return` 文が効率よく行われる。

### 10.2 反復子の利用

* `begin()` と `end()` がいちばん基本的な反復子だ。
* 標準ライブラリの探索アルゴリズムの多くが、見つからなかったことを伝えるために
  `end()` を返す（正確に言うと、引数として渡した半開区間の終端を指す反復子を返す）。
* 反復子を使うと、アルゴリズムとコンテナが分離できる。このモデルにより汎用性と柔軟性が高まる。
  * アルゴリズムはデータが格納されているコンテナについては何も知らない。
  * コンテナは、データに適用されるアルゴリズムについては何も知らない。

### 10.3 反復子の型

特定の反復子の型をユーザーが意識しなければならない場面はほとんどない。

### 10.4 ストリーム反復子

ストリームが値のシーケンスを読み書きすることから、反復子の概念をストリームに適用できる。

* `ostream_iterator` を作るには、出力ストリームと出力オブジェクトの型の両方の指定が必要だ。

  * 出力ストリームはコンストラクターの引数とする。
  * 出力オブジェクトの型をテンプレート引数とする。

* `istream_iterator` も同様だ。ただし終端についてはストリームの指定をできない。
* これらの反復子を p. 118 のように直接利用することはほとんどない。
  アルゴリズムの引数として与えるのがふつうだ。

デモコードの一時変数についての書き換えについて。
C++11 から中括弧でコンストラクターを呼び出せるようになったことが実は大きいのでは？
C++03 だと p. 120 のコードを丸括弧で書くとダメコンパイラーが文句を言ったと記憶している。

### 10.5 述語

処理をアルゴリズムの引数とすることもできる。特に `bool` 値を返すようなものを述語という。

述語の形式には関数、関数オブジェクト、ラムダ式が考えられる。

```c++
auto p = std::find_if(
    m.begin(), m.end(),
    [](const std::pair<std::string, int>& r){ return r.second > 42; });
```

### 10.6 アルゴリズムのまとめ

〈アルゴリズムの一般的な定義は、“特定の問題を解くための一連の演算を提供する
有間個の規則であり、しかも五つの重要な機能である有限性、確定性、入力、出力、
効率性をもっているもの”(Knuth, 1968) である。C++ 標準ライブラリでのアルゴリズムの定義は、
要素のシーケンスを処理するための関数テンプレートである〉。これは諳んじられるようにしておきたい。

* ヘッダーファイル `<algorithm>` に数十ものアルゴリズムが定義されている。
* 標準アルゴリズムは、入力シーケンス一つを受け取るのに半開区間で表される二つの反復子を引数に取る。
* 標準アルゴリズムの多くが、コンテナ、文字列、組み込み型の配列に適用できる。
* コンテナ内の要素を加えたり取り除いたりするアルゴリズムはない。
  アルゴリズムはコンテナを知らない。

### 10.7 コンテナアルゴリズム

* シーケンスを一対の反復子で扱うことで、汎用的かつ柔軟さを得られる。
* コンテナ全体に対してアルゴリズムを適用することが多いが、それが望みなら自作できる。

### 10.8 アドバイス

抜粋する。

> (6) ループを記述する際は、汎用アルゴリズムとして表現できるかどうかを検討しよう。  
> (8) 述語は、引数を更新してはならない。  
> (9) 標準アルゴリズムを理解して、手作りのループよりも優先しよう。  

----

第 9 章 コンテナ

### 9.1 はじめに

コンテナとは、オブジェクトを内部に保持することを目的とするクラスのことだ。

### 9.2 `vector`

* 標準コンテナの中で最も有用。
* オブジェクト初期化のコードが中括弧でなされているので注意（このクラスに限った話ではないが）。
* 範囲 `for` ループが利用できる。
* 〈標準ライブラリの `vector` を使っているのは、`push_back()` を繰り返したときの効率がよいからだ〉からの
  メモリと要素の確保の基本についてはよく読んでおく。
  * 〈私は `reserve()` を性能向上のために使ったことがある。しかし、無駄な努力であることが判明した〉。
    要素の再確保を回避するときだけに使うようだ。
* コピーが望ましくないときは、参照やポインタ、あるいはムーブ演算を使う。

TBW

### 9.3 `list`

* 要素を移動することなく、要素の挿入や削除を行う必要があるシーケンスに対して利用するものだ。
* 走査やソートと探索などでは `vector` のほうが性能が高い。

### 9.4 `map`

* `map` は連想配列や辞書などと呼ばれることもあり、平衡二分木として実装される。
* `map` は探索に特化されている。
* 角括弧よりも `find()` や `insert()` を使うと、不意に値が追加されることを避けられる。

### 9.5 `unordered_map`

* `map` の探索コストは対数オーダーであり、効率的ではあるのだが、順序判定を必要としないハッシュベースの探索のほうが効率は優る。
* `unordered_map` のインタフェースは `map` とよく似ている。というか、同じでないとおかしい。
* ハッシュ関数を自作することもできる。その場合にはクラステンプレートの引数に自作関数を指定する。

### 9.6 コンテナのまとめ

* 非順序コンテナはキーによる探索用に最適化されている。
* 〈`queue<T>`, `stack<T>`, `priority_queue<T>` というコンテナアダプタを提供する〉。
  これらの内部に標準コンテナが含まれている。
* 標準コンテナとその基本的な処理は、コンテナが異なっていても記法と意味が画一であるように設計されている。
* `forward_list` は空のシーケンスに対して最適化が行われている。〈意外にも便利だ〉そうだ。

### 9.7 アドバイス

一部を抜粋する。

> (4) デフォルトのコンテナとして `vector` を利用しよう。  
> (9) 要素数を変更した `vector` に対して、反復子を利用しないように。  
> (17) `map` は、一般的に、赤黒木として実装される。  
> (18) `unordered_map` は、ハッシュ表である。  
> (19) コンテナは、参照渡しで与えて、値で返却しよう。  
> (20) コンテナの要素数指定には `()` 構文の初期化子を利用して、要素の並びの指定には `{}` 構文を利用しよう。  
> (21) メモリ上で連続するコンパクトなデータ構造を優先しよう。  
> (22) `list` の走査は、比較的高コストである。  
> (25) 要素の型が自然な順序をもたない場合は、非順序コンテナを利用しよう。  
> (28) 標準ライブラリのコンテナを熟知して、手作りのデータ構造よりも優先させよう。  

----

以上

[metal]: http://metal.the-ninja.jp/ 
[soejima1000]: https://www.youtube.com/user/soejima1000/videos
