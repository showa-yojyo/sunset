---
title: 176 日目（晴れのち雨）プログラマーの性分で人様のコードをやりたい放題
---

0:25 石碑（強）のコードもユーザーデータベース準拠に書き換える。
ロジックは強のほうが単純な構造になっている。単体テストは明日にとっておいて寝る。

日の出前に一度目が覚める。体が冷えてトイレ。

9:00 起床。やはり寒い。SQL の本を読みつつ朝食をとってすぐに外出。

9:40 明治通りが遠い。東向島広小路に出るはずが、百花園停留所から日暮里駅行きの都バスに乗る。
やがて荒川区役所前で降りて公園を横切って図書館に向かう。

10:05 ゆいの森あらかわに入館。どうにも手続きが面倒だ。
体温、消毒、入館票、タイムスタンプのフルセットがある図書館は今の所ここだけ。
四階吹き抜け前の座席に陣取る。持ち込み PC を開いて二時間ほど作業しよう。

* 明日の面接の所在地を確認。いつもの地下鉄一本で行けそうだ。
* [![【Mリーグ初】幻のレア役！槍槓で和了 - YouTube](http://img.youtube.com/vi/oHfOdK8GLhM/1.jpg)](https://www.youtube.com/watch?v=oHfOdK8GLhM):
  再生直後、実況が日吉プロと気づいた時点でこれは面白そうだと思ったら、期待以上の実況で満足。
* DeepL の英語から日本語への翻訳機能を HTML の仕様書や Wizardry のテキストに対して試す。

12:20 退館。雨がぱらついている。天気予報を確認して来なかったから傘などはない。

12:40 区役所前のバス停から亀戸駅行きに乗って東向島広小路へ移動。
セブンイレブンで道草を食ってから曳舟の部屋に戻る。

13:30 麻雀の練習をしながらおやつ休憩。どうも PC が重い思ったら Windows Update が裏で走っていた。OS 再起動。

外は雨なので外出せずにウディターいじりをやる。スーツを買いに行きたいところだが。

* マップイベント側の石碑コードの HP 回復をコモンイベントに移す。
* 石碑（弱）で途中逃走でも制覇フラグを ON にする一連の処理を実行するミスを修正。デグレ。
* 石碑で、同じ敵を連続して出現させていたミスを修正。デグレ。

ウディターの `CSelf` 変数の管理画面でちょこちょこやると必ず上のようなタコミスを犯す。自分の中でキメを作らないと。

* 石碑のいずれかが制覇しているかをテストするサブルーチンを実装。それに伴い幻影挑戦フラグ廃止。
* デバッグメニュー実装。デバッグモードのときに限り地獄ウサギのメニューの末尾に追加。
  というより、デバッグモードならばウサギのメニュー全体をデバッグメニューに差し替えたほうが自然か。

* フラグショップを実装しようとしたが、メニューのサイズが小さすぎてショボい。
* レベル最大化機能。既存のデバッグイベントを分割して移転。
* 所持金最大化機能。これも既存のデバッグイベントを分割して移転。
* 所持品最大を実装。
* その他もろもろ

以前石碑マップイベントを接触範囲で書き直したのは実は悪かった。幅 2 キャラぶんの範囲をきれいに指定することが不可能なのだ。
幅を 2 にすると半キャラ横にずれる不具合を生じるし、幅を 3 にするとそっぽを向いても Enter キーでイベントが発生する。

ウディターはイベントウィンドウの最小化をなぜ無効化しているのだ。最大化できるウィンドウは最小化もできないといけない。

18:40 外出。ひきふね図書館。朝刊の残りと夕刊を読む。小説すばる 2020.11 号も一部連載をチェック。トイレを使って退館。

水戸街道に出てコモディイイダに向かう。東向島一丁目バス停よりも向島寄りにあるのか。

19:50 コモディイイダ東向島店。460 円。

* 中華丼
* びんちょうまぐろ
* バターロール (5)

20:00 曳舟の部屋に戻る。PC を開きつつ晩飯。刺身皿などという洒落たものはないのでパックのまま食う。
つまみながら麻雀の練習。

21:00 ウディターに戻る。職業病のようなもので気になるだけだが、文章中にキャラクター名がハードコードされているのはもう直せないだろう。
編集ツールに grep がないようでは。

アステカステージのリファクタリングをしたい。8 ステージおおむね同じなので共通化する。違いが目立つのは報酬の部分か。

* トップバッター出現敵グループの ID
* クリア済みフラグのアドレス (20000xx)
* 勝利後テキスト
* 報酬タイプ：武器 or 防具
* 報酬の武器 ID or 防具 ID
* 衣装 ID or NULL

22:10 アステカステージのユーザーデータベースの仕込みが終わったところで入浴。

22:45 風呂から出る。最近入浴時間が長い。夏が終わればこんなものか。テザリング。

ウディターに戻ってサブルーチン追加。アウトライン：

```text
Azteca::run_stage(stage_id):
    Azteca::setup_stage()
    ループを回して 4 回戦
    Azteca::on_cleared()
        ステージクリアフラグ？:
            メッセージ表示
            最終ステージ？:
                Azteca::win_reward_final()
            Azteca::win_reward_item(stage_id)
            Azteca::win_reward_costume(stage_id)
            ステージクリアフラグをセット
    Azteca::cleanup_stage()
```

最終目的はコモンイベント「アステカステージ k」の実装を `Azteca::run_stage(k)` の一行に置き換えること。
アステカメニューの更新が残っている。これは文字列変数を減らすように方式を変更したい。

23:40 明日は面接なのでこれ以上コード作業はできない。
落ち着いた音楽を聴きながら麻雀の練習でクールダウン。
よく見たらイヤホンの付け根がイッちゃっているが音が鳴るので無問題。
