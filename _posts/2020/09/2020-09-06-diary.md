---
title: 133 日目（曇り時々雨）よくある日曜日
mathjax: true
---

ある日、夢の中でのノーセーブチャレンジ何度目かの挑戦。
最初のダンジョンの地下四階宝物庫前まで取り戻す。次元断を覚えてから落とし穴に行きたい。
0:40 に床の上に就寝。

8:10 に目が覚める。洗濯物が軽く溜まっているので洗濯機を運転する。待ち時間はベッドで寝る。

9:10 洗濯物を干す。朝食。股のかゆみがぶり返してくる。
サンデーモーニングを視聴。出演者が高齢者メインで静かなのがこの番組の長所だ。

9:50 なかなか次元断を覚えないので面倒になって落とし穴に行く。また全滅。
このゲームは眠り状態が深刻。いったん寝ると自分から起きることがない。
あとドリームペインターだけの性質かもしれないが、寝ているときに常識はずれのダメージを受けることがある。
守備力を上げる方法もあるが、基本的には速攻で倒さないといけない。

バスに乗って八広方面に足を伸ばす。八広図書館で PC 作業をして向島に戻ってくる。

13:20 ローソンストア 100 言問橋店。284 円。

* 手巻きおにぎり梅
* カレーパン (2)
* お手軽冷やし中華

向島の部屋に戻る。昼飯。浅田姉妹の食事会番組を途中まで見て外出。

横川コミュニティー会館図書室。刑務所なう 2 と教科書を読む。堀江氏の本はもう少しで完読。

タイトー F ステーションオリナス錦糸町店。ビートマニアと MJ をけっこう遊ぶ。
レベル 12 の曲のクリアランプをもう一曲点灯できる。Red by ほにゃらら。1990 年と同作者の曲だ。
スクラッチがキツイだけなら勢いでなんとかクリアできるものだ。

```text
【SCORE】
合計SCORE:-163.3

【最終段位】
四人打ち段位:神龍 幻球:10

【9/6の最新8試合の履歴】
1st|*----*--
2nd|-**-----
3rd|------**
4th|---**---
old         new

【順位】
1位回数:3(16.67%)
2位回数:4(22.22%)
3位回数:5(27.78%)
4位回数:6(33.33%)
平均順位:2.78

プレイ局数:77局

【打ち筋】
アガリ率:22.08%(17/77)
平均アガリ翻:2.76翻
平均アガリ巡目:10.71巡
振込み率:12.99%(10/77)

【9/6の最高役】
・跳満
```

19:35 カスミオリナス錦糸町店。287 円。豚キムチ丼。

20:00 ビッグエー墨田業平店。305 円。

* スライスチーズ (5)
* 小粒納豆 (3)
* 絹豆腐 (3)
* 大きなおむすび鮭

会計を済ませた途端に土砂降り。傘を持っているとはいえ大雨が過ぎる。少々待って勢いが衰えたところで地下鉄へ移動。
浅草線に乗って本所吾妻橋駅まで移動する。地上へ出ると雨が一時的にだろうがやんでいる。歩いて向島の部屋に戻る。

シャワーを浴びて晩飯。豚キムチ丼とチーズの相性が良い。

21:15 テザリング終了して数学ノートを始める。プログラミングに使えそうだ。

22:20 ノート終了。確率行列は線形代数の演習問題で見かけたのが最後だったが、こんな遠くに来たところで再会するのか。

ある日～をレベル 24 まで上げる。

## Math Notes

薩摩順吉『確率・統計』第 7 章続き。

----

Markov 自身が例示した**時間的に一様な Markov 過程**の例を見ていく。
概要：

* ツボ A と B とがある。初期状態で A には赤い玉が $2$ 個、B には白い玉が $2$ 個入っている。
* それぞれのツボから玉を一つずつ取り出して swap してツボに戻す。
* 何回も swap するとツボの中身はどうなっているかを考える。

時刻 $t = 0, 1, \dotsc, n, \dotsc$ で swap するとし、
$X(t)$ を swap 直後の A の白玉の数であるとする。${X(t) \in \{0, 1, 2\}}.$

* $X(n - 1) = 0$ ならば次の swap で $X(n) = 1$ であることが確定しているので
  
  $$
  P(X(n) = 1 \vert X(n - 1) = 0) = 1.
  $$

* ${X(n - 1) = 1}$ ならば $X(n)$ は $0, 1, 2$ すべての値をとり得る。
  ${X(n) = 0}$ と「A の白玉と B の赤玉を swap した」は同値であるので：

  $$
  P(X(n) = 0 \vert X(n - 1) = 1) = \frac{1}{2}\cdot\frac{1}{2} = \frac{1}{4}.
  $$

* ${X(n) = 1}$ は二通りあり得る。

  * A の白玉と B の白玉を swap
  * A の赤玉と B の白玉を swap

  したがって：

  $$
  P(X(n) = 1 \vert X(n - 1) = 1) = \frac{1}{2}\cdot\frac{1}{2} + \frac{1}{2}\cdot\frac{1}{2} = \frac{1}{2}.
  $$

* ${X(n) = 2}$ となるのは A の赤玉と B の白玉を swap したときであるから

  $$
  P(X(n) = 2 \vert X(n - 1) = 1) = \frac{1}{2}\cdot\frac{1}{2} = \frac{1}{4}.
  $$

* ${X(n - 1) = 2} \iff {X(n) = 1}$ であるから

  $$
  P(X(n) = 1 \vert X(n - 1) = 2) = 1.
  $$

以上ですべての場合を尽くしている。

----

**推移行列**。上記の状況を表にすると次のようになる。

$$
\def\arraystretch{1.5}
\begin{array}{r|}
& X(n) = 0 & X(n) = 1 & X(n) = 2\\
\hline
X(n - 1) = 0 & 0 & 1 & 0\\
X(n - 1) = 1 & 1/4 & 1/2 & 1/4\\
X(n - 1) = 2 & 0 & 1 & 0\\
\end{array}
$$

これを行列で書く：

$$
\def\arraystretch{1.5}
\begin{pmatrix}
0 & 1 & 0\\
1/4 & 1/2 & 1/4\\
0 & 1 & 0\\
\end{pmatrix}
$$

一般に、時間的に一様な Markov 過程で、$X(t)$ が $k$ 個の状態
$x_1, \dotsc, x_k$ をとり、各時刻において状態 $x_i$ から $x_j$ への推移確率を
$p_{ij}$ で表すと、推移行列 $P$ は次のようになる：

$$
\def\arraystretch{1.5}
P = \begin{pmatrix}
p_{11} & \cdots & p_{ik}\\
\vdots & \ddots & \vdots\\
p_{k1} & \cdots & p_{kk}\\
\end{pmatrix}\!.
$$

ここで $P$ は条件付き確率を並べたものになっていて、各行の和が $1$ であることに注意する。

----

例題：ある大学の講師はなるべく連続して休講しないようにしている。

* 一度休講すると次の回は $10\%$ の確率でしか休講しない。
* 休講しなかった回の次の回は $30\%$ の確率で休講する。

ある回から次の回への推移確率を決定しろ。

解：休講と開講をそれぞれ $x_1, x_2$ で表す。条件付き確率を求める。

$$
\begin{aligned}
p_{11} &= P(X(n) = x_1 \vert X(n - 1) = x_1) = 0.1,\\
p_{12} &= P(X(n) = x_2 \vert X(n - 1) = x_1) = 1 - 0.1 = 0.9,\\
p_{21} &= P(X(n) = x_1 \vert X(n - 1) = x_2) = 0.3,\\
p_{22} &= 1 - p_{21} = 0.7.\\
\end{aligned}
$$

$$
\therefore P = \begin{pmatrix}
0.1 & 0.9\\
0.3 & 0.7\\
\end{pmatrix}\!.
$$

----

**Chapman-Kolmogorov の式**。テーマ：状態 $x_i$ から $x_j$ まで
$l$ 回の推移で変わる確率を $p_{ij}{}^{(l)}$ とおく。この値はどのようなものか。

$l = 1$ のときは当然 $p_{ij}{}^{(1)} = p_{ij}.$

$l = 2$ のとき。これは状態 $x_i$ と $x_j$ の間に状態が一つ挟まる遷移である。
その中間状態を $x_r$ とおく。

$$
x_i \longrightarrow x_r \longrightarrow x_j.
$$

これらの遷移の確率がそれぞれ $p_{ir}, p_{rj}$ であるから、次のようになる：

$$
p_{ij}^{(2)} = \sum_{r = 1}^{k} x_{ir}x_{rj}.
$$

一般の $l$ については次のように考える。$l$ 回の遷移と ${l - l^{\prime} }$ 回の遷移を全て加え合わせればよい。

$$
p_{ij}{}^{(l)} = \sum_{r = 1}^k p_{ir}{}^{(l^{\prime})}p_{rj}{}^{(l - l^{\prime})}.
$$

この式を Chapman-Kolmogorov の式と呼ぶ。

----

Chapman-Kolmogorov の式から $p_{ij}^{(l)}$ は再帰的にすべて $p_{ij}$ で表せる。

----

$P^2$ の $(i, j)$ 成分は $p_{ij}^{(2)}$ に等しい。
同様に $P^3$ の $(i, j)$ 成分は $p_{ij}^{(3)}$ に等しい。
一般に $P^l$ の $(i, j)$ 成分は $p_{ij}^{(l)}$ に等しい。

ゆえに $p_{ij}^{(l)}$ の計算には $P_l$ を求めて $(i, j)$ 成分を見ればよい。

----

例題：先ほどの大学講師が、ある回に休講して $3$ 回後にも休講する確率を求めろ。

解：得るべきものは $p_{11}^{3}$ である。したがって $P^3$ の $(1, 1)$ 成分が求める確率である。

```python
>>> import numpy as np
>>> P = np.array([[0.1, 0.9], [0.3, 0.7]]); P
array([[0.1, 0.9],
       [0.3, 0.7]])
>>> P @ P @ P
array([[0.244, 0.756],
       [0.252, 0.748]])
```

したがって $0.244$ が答えである。
$\blacksquare$

----

**推移確率の極限**。$p_j \coloneqq p_{ij}{}^{(\infty)}$ とおく。大学講師の例では

$$
\def\p{ \begin{pmatrix}p_1 & p_2\end{pmatrix} }
\p P = \p
$$

である必要がある。この方程式と $p_1 + p_2 = 1$ から

$$
p_1 = 0.25, \quad p_2 = 0.75
$$

がわかる。

----

例題：さきほどのツボの例題において、「最終的」に

* A に白玉がない状態になる確率、
* A に白玉が $1$ 個ある状態になる確率、
* A に白玉が $2$ 個ある状態になる確率

をそれぞれ求めろ。

解：方程式を立てると次のようになる。

$$
\def\p{ \def\arraystretch{1.0}\begin{pmatrix}p_0 & p_1 & p_2\end{pmatrix} }
\p\def\arraystretch{1.2}
\!\begin{pmatrix}
0 & 1 & 0\\
1/4 & 1/2 & 1/4\\
0 & 1 & 0\\
\end{pmatrix}\!
= \p
$$

$$
\begin{cases}
& \dfrac{1}{4}p_1 & &= p_0,\\
p_0 + & \dfrac{1}{2}p_1 + &p_2 &= p_1,\\
& \dfrac{1}{4}p_1 & &= p_2,\\
\end{cases}
$$

${p_0 + p_1 + p_2 = 1}$ と合わせて解くと ${p_1 = \dfrac{2}{3},}\quad{p_0 = p_2 = \dfrac{1}{6}}.\quad\blacksquare$

----

以上
