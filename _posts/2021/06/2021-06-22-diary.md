---
title: 422 日目（曇のち晴れ）WebGL プログラミングの手筋をいくつか習得した
---

コード移植の途中だが今晩はもうおしまい。撤収準備。麻雀ビデオを観て寝る。

* [【まさかの結末】Mリーガー小林剛、らしさ全開の仕掛け【麻雀】 - YouTube](https://www.youtube.com/watch?v=0FpEH5Uxi-A)
* [小林剛　鳴けないから面前でテンパイしちゃいました💦 - YouTube](https://www.youtube.com/watch?v=pfbz8O2U-Zo)

1:30 就寝。寝付けない。明け方近くになって異様に眠くなる。

7:05 起床。今日はダメだ。納豆と飯を食う。出勤。水筒を忘れる。

7:40 現場。もうゴミ周りの雰囲気が怪しい。可燃ゴミの日だが例によって雑多なゴミが大量に混入している。
空き缶、ペットボトル、吸い殻、不燃ゴミの選り分けが厄介そうだ。管理人室で準備。

定刻に勤務開始。ひたすらゴミをいじりつづける。手袋の指先がまたぞろ裂ける。これもダメだ。

10:00 ゴミ処理で時間が押して、館内清掃がまだ終わらない。しばらくして打ち切らせてもらう。

イトーヨーカドー曳舟店で体温チェック＆トイレ。

10:50 コンビニに寄らずに部屋に戻る。半裸になって PC で時間つぶし。
[An intro to modern OpenGL][duriansoftware] の hello world を WebGL に移植する。

* [three.js - Why do I need to define a precision value in webgl shaders? - Stack Overflow](https://stackoverflow.com/questions/27058064/why-do-i-need-to-define-a-precision-value-in-webgl-shaders):
  古いシェーダーを WebGL に移植する際に `float` でエラー `No precision specified for (float)`
  が出たので調べたらこのページがヒットした。

12:20 テクスチャー以外はすべて移植できたか。インデックス配列を Float32 で作ったのはタコミスだった。
オリジナルコードでは tga ファイルを読み込んでテクスチャーマッピングを実現している。
画像は HTML の `img` で処理するのでこのフォーマットでは不可能。外部で JPEG 辺りに変換しておく？

* [WebGLRenderingContext.texImage2D() - Web APIs &#x7c; MDN](https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/texImage2D):
  * WebGL には理由不明だが `GL_BGR` 相当のシンボルが存在しない。
  * `GL_RGB8` 相当のシンボルは WebGL2 ならば利用可能を確認。

14:00 寝不足なのを忘れていた。昼寝。

15:20 起き上がる。暑くてダメだ。PC をもう一度開いて時間つぶし。
突然の来客。心当たりが全然ないので扉を開いて確認すると、牛乳屋のセールスだ。驚かせるな。
私の身なりを見てすぐに退散する。

16:10 外出。スカイツリータウンに移動。書店で雑誌チェック。といっても週プレの TOUGH とニューズウィーク日本版しか触る時間がない。
有明 T ビルとはもしやかつての私の職場のあったビルではないか。

17:10 押上駅バス停に移動。しばらくしてからバスに乗って錦糸公園前へ。
公園ベンチで携帯電話をチェックする休憩。カイジ事典みたいなページを見る。

18:00 タイトー F ステーションオリナス錦糸町店。MJ プロ卓東風戦 4 クレ。

トップもラスもないという穏やかな展開。最後のゲームはオーラスをラス目で迎えてひじょうに危なかった。
一本場、対面の親がカンを入れたり、私の手でドラ一筒が重なったりで流れが変わってくる。
いい感じに両面のテンパイが入ったのでリーチ。ツモってもシステムに四着終了の可能性があると言われる始末。
構わずアガリボタンを押すと、カンドラの裏がまたしても一筒で跳満になる。
親ッカブリをかませてラスを押し付けることに成功。これならトップなしでもギリギリ許せる。

```text
【SCORE】
合計SCORE:-35.1

【最終段位】
四人打ち段位:伏龍 幻球:8

【6/22の最新8試合の履歴】
1st|--------
2nd|---**-*-
3rd|--*--*-*
4th|--------
old         new

【順位】
1位回数:0(0.00%)
2位回数:3(50.00%)
3位回数:3(50.00%)
4位回数:0(0.00%)
平均順位:2.50

プレイ局数:34局

【打ち筋】
アガリ率:17.65%(6/34)
平均アガリ翻:3.50翻
平均アガリ巡目:13.33巡
振込み率:8.82%(3/34)

【6/22の最高役】
・跳満
```

19:45 カスミオリナス錦糸町店。288 円。

* 麻婆豆腐丼
* ブラックチョコ

20:05 ビッグエー墨田業平店。341 円。

* 絹豆腐 (2)
* 小粒納豆 (3)
* おにぎりセット（鮭・ゆかり）
* 大きなツナオニオンパン
* コッペパンジャム＆マーガリン

20:15 曳舟の部屋に戻る。歩いていると熱くなる。シャワーを先に浴びて風呂場から出る。
白ブリーフ一丁で PC 作業を始める。晩飯も。豆腐をわざとかぶせる。

21:15 麻雀の練習終わり。流しを片付けてメールチェックなど。

* [&#x23;640 ドラゴンスピリット Dragon Spirit 1面 BGM - YouTube](https://www.youtube.com/watch?v=NLCsN2_gkqw): ダウンロード。
* [javascript - raw jpeg data loading in webgl texture synchronously - Stack Overflow](https://stackoverflow.com/questions/12594908/raw-jpeg-data-loading-in-webgl-texture-synchronously)

昼間にやっていた WebGL 移植のテクスチャーマッピングのコードをデバッグするところまでこぎつける。
天地逆にテクスチャーが貼られる以外は正常動作している。
少し調べると、オリジナルの TGA ファイルとブラウザーで扱えるように変換した JPEG ファイルとの内部フォーマットの違いから来る可能性が高そうだ。
画像コンバーターのバグトラッカーにそういう不具合が出てくる。
これを解決するにはテクスチャー座標を全部天地逆にするか、上の Stack Overflow で紹介されている OpenGL API を適用する。
決め打ちになるが後者のほうが楽だ。

久しぶりに XBox Game Bar でビデオ撮影。Sleipnir のタブを別ウィンドウで表示すればキャプチャーできるようだ。
シンプルなアニメーションなので 10 秒もあればいいだろう。Twitter に投稿しておく。
投稿ネタのバリエーションを増やしたい。

* [【CBパック続き】新パックと未プレー曲など中心に！beatmania IIDX 定期配信 #123【DOLCE. / INFINITAS / 音ゲー】 - YouTube](https://www.youtube.com/watch?v=lpI3CO4Q3ko):
  今日の作業時間中にちょこちょこ聴いている。看板に偽りアリで、プロが Fascination MAXX を連奏しまくっている恐ろしい放送のアーカイブ。
* [夏季超人五輪２０１５「VS.レッキングクルー」 - YouTube](https://www.youtube.com/watch?v=tFlb3sLn3Qs):
  マリオとルイージがそれぞれステージの表裏にいるのが珍しい。

[duriansoftware]: https://duriansoftware.com/joe/an-intro-to-modern-opengl.-table-of-contents
