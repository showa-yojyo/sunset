---
title: 325 日目（晴れ）もっと早く郵送して欲しい
---

今日の予定が二つある。休館日前なので仕事終わりに PC を持って図書館に行くことと、洗濯をすることだ。
それに加えて、高確率で給与明細が日中に郵送されるはずなので、それを福祉事務所に提出しに行くイベントも発生するだろう。
これは金が絡む話なので先延ばしにできない。昼過ぎに体力が保つか？ 居眠りして福祉事務所の営業時間内に行く時間が消えないか？

怒ってた猫が急に話しかけてきたビデオを再生してから寝る。夜中は寒さが失せて快適に睡眠をとることができた。

7:05 起床。納豆とメシを食って外出。陽気が良くなることを考えて服を一枚省略する。

7:35 現場到着。管理人室で資源ゴミの仕込みから始める。8:00 から正式に作業開始。
裏庭の猫の糞が真新しい。共用部の水道管収納箱の表面の汚れ方が微妙。外が暑い。

10:00 作業を終了する。報告書を記入して撤収。八広へ移動。

10:20 八広図書館。朝刊（東京）を読んで入館。キャレルで PC を広げて作業。

* ファイル同期
* ファイル更新。WSL の Miniconda は超速で良い。
* メールチェック。何もない。
* [&num;611 ザ・スーパー忍 The Revenge of Shinobi BGM ギターメドレー - YouTube](https://www.youtube.com/watch?v=tijdcaoLHaQ)
* [Scrapy][scrapy] の演習。[東京銭湯マップ](https://www.1010.or.jp/map/item) を 1 秒の wait をかけて這い回る。
  495 軒の簡易リストが得られた（もう手許に上位互換データがあるが）。

12:10 退館。イトーヨーカドー曳舟店に寄って体温を計る。コンビニに行って雑誌棚を見る。
曳舟の部屋に戻るが、廊下でゴチャゴチャやっていて通れないので少し待つ。

12:50 部屋に入れる。汚れた衣類を放り込んて洗濯機を回す。PC を戻しておやつ休憩。
さっきやりかけていたブログのリンク付け作業を少しやる。あと誤字脱字のたぐいをなるべく修正する。

胃袋の中身が消化されるまで麻雀の練習。Windows Update のアイコンがタスクトレイに出ているので再起動して休止状態にするのか。
時間がかかりそうなので電源を消すのを諦めて寝る。

15:30 起き上がる。PC の自動更新処理が終わったことを確認して電源を切る。
期待している郵便が来ないので外出する。スカイツリーに寄ってから押上駅バス停へ移動。バスに乗って太平四丁目へ。

16:50 タイトー F ステーションオリナス錦糸町店。MJ プロ卓東風戦 6 クレ。
昨日までの反省点を活かせたのではないか。

```text
【SCORE】
合計SCORE:+74.7

【最終段位】
四人打ち段位:魔神 幻球:8

【3/17の最新8試合の履歴】
1st|---**--*
2nd|-*------
3rd|*-*--**-
4th|--------
old         new

【順位】
1位回数:3(30.00%)
2位回数:2(20.00%)
3位回数:4(40.00%)
4位回数:1(10.00%)
平均順位:2.30

プレイ局数:54局

【打ち筋】
アガリ率:18.52%(10/54)
平均アガリ翻:3.10翻
平均アガリ巡目:10.20巡
振込み率:7.41%(4/54)

【3/17の最高役】
・倍満
・跳満
```

19:45 カスミオリナス錦糸町店。455 円。

* オクラ茄子丼
* メンチカツ
* ブラックチョコ
* ライス

20:10 ビッグエー墨田業平店。344 円。さっき白飯を調達できたことを忘れてロールパンを買ってしまう。

* テーブルロール (5)
* コロッケバーガー
* あんパン
* ポテコうましお

20:25 曳舟の部屋に戻る。バイト先の郵送物が届いている。給与明細は明日にする。
PC に戻って家計簿と日記を進める。晩飯を食いながら麻雀の練習。そういえばオクラ茄子丼の味付けが変わった？

21:10 少しだけテザリングタイム。Scrapy の学習。

22:00 いったん入浴する。22:35 出る。Scrapy をやる。

22:55 学習時間が終わる。[ウルファールのサンプルゲーム with DTC][bshf21b] をやる。
ミカコ城入城からテキトーにプレイ。ノーセーブで行くと宝箱でうっかりミスで全滅しやすい。
例えば浄化システム対策でロズモンド、ビビアン、夕一で挑んで、間違えて夕一まで隠れるとか。

## Scrapy Note

ドキュメントの順番通りにやるなら今日のテーマは Item Loaders だ。
しかし難しいし習得優先度が低い内容なので後回しとする。

### Scrapy シェル

Scrapy シェルは UNIX や Python の IDLE のそれと同様に対話的シェルだ。
スパイダーを走らせることなくスクレイピングコードを素早く試すことができる。
このシェルはデータを抽出するコードをテストするのに使うことを目的としているが、ふつうの Python シェルとしても利用できる。
XPath 式や CSS セレクター式を対話的にテストするのに使うといい。

#### シェルを構成する

私の環境ではコマンド `scrapy shell` で IPython が起動する。
この振る舞いは構成ファイル `scrapy.cfg` や環境変数 `SCRAPY_PYTHON_SHELL` を設定することで変えられる。
とはいっても私は IPython ユーザーであるので、以下、IPython がインストールされていることを前提として記す。

#### シェルを走らせる

コマンド `scrapy shell` の引数に URL やローカルファイルパスを与えるのがふつうだ。
ただし、カレントディレクトリーにあるファイルを指定するときには `./` を明示しないと文字列は URL を表すものとして Scrapy に解釈されて失敗する。

```console
bash$ scrapy shell https://www.example.com/
bash$ scrapy shell ./path/to/file.html
bash$ scrapy shell ../other/path/to/file.html
bash$ scrapy shell /absolute/path/to/file.html
bash$ scrapy shell file:///absolute/path/to/file.html
```

#### シェルを使う

常に利用可能な関数一覧：

| function | description | comment |
|----------|-------------|---------|
| `shelp()` | Scrapy 固有のシェル関数・変数を出力する | その他のオブジェクトも一覧に現れるようだ |
| `fetch(url[, redirect=True])` | 新しい応答を取得して関連オブジェクトすべてを更新する | |
| `fetch(request)` | 上記とだいたい同じ | こちらのほうが簡単 |
| `view(response)` | 応答をブラウザーで表示する | 自動的に削除されない一時ファイルを生成する |

常に利用可能なオブジェクト一覧：

| object   | description | comment |
|----------|-------------|---------|
| `crawler` | 現在の `Crawler` オブジェクト | 未習 |
| `spider` | 与えた URL を処理することができる `Spider` オブジェクト | 場合によっては `None` |
| `request` | 最後に取得したページの `Request` オブジェクト | `fetch()` により更新 |
| `response` | 最後に取得したページを含む `Response` オブジェクト | |
| `settings` | 現在の Scrapy 設定 | `dict` オブジェクト |

#### セッションの例

ドキュメントにある例を再現するなり、好きなページでアレンジして試すなりすること。

#### 応答を検査するのにスパイダー内からシェルを起動する

関数 `scrapy.shell.inspect_response(response, spider)` を `parse()` 内から呼び出すなどする。
この機能を `breakpoint()` 感覚で利用するのだろう。あとで試したい。

ただしこのセッションでは `fetch()` を利用してはならない。スパイダーが壊れる。

[bshf21b]: https://wodifes.net/game/show/446
[scrapy]: https://scrapy.org/
