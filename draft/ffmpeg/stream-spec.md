---
title: ストリーム指定子
status: RC
---

`ffmpeg`, `ffprobe` 共通してある、ストリームを指定する書記法について記す。

## 概要

これらのコマンドラインオプションには、`bit_rate` や `codec` など、ストリームごと
に適用されるものがある。ストリーム指定子は、与えられたオプションがどのストリーム
に属するかを正確に指定するものだ。

ストリーム指定子は、一般にオプション名の後にコロン `:` で区切られた文字列だ。例
えば、`-codec:a:1 ac3` は `a:1` 部分がストリーム指定子だ。これは二番目の音声スト
リームにマッチする（序数はゼロから）。したがって、オプション全体の意味は「二番目
の音声ストリームを `ac3` に」くらいになる。

ストリーム指定子は複数のストリームにマッチさせることも可能だ。その場合、オプショ
ンはそれらのストリームすべてに適用される。例: オプション `-b:a 128k` では、すべ
ての音声にマッチする。

空のストリーム指定子はストリームすべてにマッチする。たとえば、`-codec copy` また
は `-codec: copy` は、すべてのストリームを再エンコードせずにコピーする。

## 主な指定方法

ストリーム指定子として可能な形式のうち、よく使うものは次の二つだ。

`stream_type[:additional_stream_specifier]`
    `stream_type` は次のいずれか一つとする（本当は他にもあり得るが省略）：

    | Symbol | Stream Type |
    |--------|-------------|
    | `v`    | 映像 |
    | `a`    | 音声 |
    | `s`    | 字幕 |
    
    `additional_stream_specifier` が使用されている場合、指定型かつ `additional_stream_specifier` に一致するストリームにマッチする。
    指定がない場合には、指定された型のストリームすべてにマッチする。例：

    * `a:0`: 音声ストリーム 0
    * `a`: 音声ストリームすべて

`stream_index`
    このインデックスを持つストリームにマッチする。例: `-threads:1 4` は、
    二番目のストリームのスレッドカウントを `4` に設定する。

    `stream_index` が上記の `additional_stream_specifier` として使われている場合、
    一致したストリームからストリーム番号 `stream_index` のものを選択する。
    ストリーム番号は通常、libavformat が検出したストリームの順序に基づく。

ビデオファイルは一般的にはストリームを複数有する。映像、音声、その他が入り乱れている可能性があり、
`v` や `a` が付記されているか否かで、インデックスの属する配列が異なると乱暴に理解してかまわないだろう。

## 参照

* [ffmpeg Documentation](https://ffmpeg.org/ffmpeg.html)
* [ffprobe Documentation](https://ffmpeg.org/ffprobe.html)
